---
traefik:
  experimental:
    kubernetesGateway:
      enabled: true

  providers:
    kubernetesGateway:
      enabled: true
      experimentalChannel: true

  additionalArguments:
    - --entrypoints.websecure.http.tls.certresolver=cloudflare
    - --entrypoints.websecure.http.tls.domains[0].main=concordalabs.com
    - --entrypoints.websecure.http.tls.domains[0].sans=*.concordalabs.com
    - --certificatesresolvers.cloudflare.acme.dnschallenge.provider=cloudflare
    - --certificatesresolvers.cloudflare.acme.email=bruno.luiz.one@gmail.com
    - --certificatesresolvers.cloudflare.acme.dnschallenge.resolvers=1.1.1.1
    - --certificatesresolvers.cloudflare.acme.storage=/certs/acme.json
  logs:
    general:
      level: debug
  ports:
    web:
      redirectTo:
        port: websecure

  service:
    enabled: true
    annotations:
      external-dns.alpha.kubernetes.io/hostname: "*.concordalabs.com,concordalabs.com"
      external-dns.alpha.kubernetes.io/cloudflare-proxied: "true"

  env:
    - name: CF_DNS_API_TOKEN
      valueFrom:
        secretKeyRef:
          key: CF_DNS_API_TOKEN
          name: cloudflare-api-credentials

  persistence:
    enabled: false # temporary, should be true
    path: /certs
    size: 128Mi
